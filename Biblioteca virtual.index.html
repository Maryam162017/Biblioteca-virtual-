<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>üìö Biblioteca Virtual</title>
<style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #000; padding: 5px; text-align: left; }
    input, select, button { margin: 5px 0; }
    .hidden { display: none; }
</style>
</head>
<body>

<h1>üìö Biblioteca Virtual</h1>

<div id="menu">
    <button onclick="mostrarLibros()">Mostrar libros</button>
    <button onclick="mostrarBuscar()">Buscar libro</button>
    <button onclick="mostrarAdminLogin()">Modo administrador</button>
</div>

<div id="contenido"></div>

<script>
// -----------------------------
// Variables y funciones
// -----------------------------
const ADMIN_PASS = "Informatica 2025";

function cargarLibros() {
    let libros = localStorage.getItem("biblioteca");
    return libros ? JSON.parse(libros) : [];
}

function guardarLibros(libros) {
    localStorage.setItem("biblioteca", JSON.stringify(libros));
}

function normalizar(texto) {
    return texto.toLowerCase().normalize("NFKD").replace(/[\u0300-\u036f]/g, "");
}

// -----------------------------
// Funciones de interfaz
// -----------------------------

// Mostrar todos los libros
function mostrarLibros() {
    const libros = cargarLibros();
    let html = "<h2>üìö Todos los libros</h2>";
    if (libros.length > 0) {
        html += "<table><tr><th>T√≠tulo</th><th>Autor</th><th>A√±o</th><th>G√©nero</th><th>Estado</th></tr>";
        for (let libro of libros) {
            html += `<tr>
                        <td>${libro.T√≠tulo}</td>
                        <td>${libro.Autor}</td>
                        <td>${libro.A√±o}</td>
                        <td>${libro.G√©nero}</td>
                        <td>${libro.Estado}</td>
                    </tr>`;
        }
        html += "</table>";
    } else {
        html += "<p>‚ö†Ô∏è No hay libros a√∫n.</p>";
    }
    html += `<br><button onclick="volverMenu()">Volver</button>`;
    document.getElementById("contenido").innerHTML = html;
}

// Buscar libro
function mostrarBuscar() {
    let html = `<h2>üîç Buscar libro</h2>
                T√≠tulo: <input id="busqueda" type="text">
                <button onclick="buscarLibro()">Buscar</button>
                <div id="resultado"></div>
                <br><button onclick="volverMenu()">Volver</button>`;
    document.getElementById("contenido").innerHTML = html;
}

function buscarLibro() {
    const busqueda = normalizar(document.getElementById("busqueda").value);
    const libros = cargarLibros();
    const resultado = libros.filter(libro => normalizar(libro.T√≠tulo).includes(busqueda));
    
    let html = "";
    if (resultado.length > 0) {
        html += "<table><tr><th>T√≠tulo</th><th>Autor</th><th>A√±o</th><th>G√©nero</th><th>Estado</th></tr>";
        for (let libro of resultado) {
            html += `<tr>
                        <td>${libro.T√≠tulo}</td>
                        <td>${libro.Autor}</td>
                        <td>${libro.A√±o}</td>
                        <td>${libro.G√©nero}</td>
                        <td>${libro.Estado}</td>
                    </tr>`;
        }
        html += "</table>";
    } else {
        html = "<p>‚ùå No se encontr√≥ ning√∫n libro.</p>";
    }
    document.getElementById("resultado").innerHTML = html;
}

// -----------------------------
// Admin
// -----------------------------
function mostrarAdminLogin() {
    const html = `<h2>üîê Acceso administrador</h2>
                  Contrase√±a: <input type="password" id="clave">
                  <button onclick="verificarAdmin()">Entrar</button>
                  <br><button onclick="volverMenu()">Volver</button>`;
    document.getElementById("contenido").innerHTML = html;
}
function verificarAdmin() {
    const clave = document.getElementById("clave").value;

    if (clave === ADMIN_PASS) {
        mostrarPanelAdmin();
    } else {

        // Mostrar mensaje en vez de alert()
        const cont = document.getElementById("contenido");
        cont.innerHTML += `
            <div style="
                margin-top: 10px;
                padding: 12px;
                background: #ffd4d4;
                border: 1px solid #c78989;
                border-radius: 6px;
                color: #700;
            ">
                ‚ùå Contrase√±a incorrecta
            </div>
        `;
    }
}
// Panel admin
function mostrarPanelAdmin() {
    const html = `<h1>‚öôÔ∏è Panel de administrador</h1>
                  <button onclick="mostrarAgregar()">Agregar libro</button><br><br>
                  <button onclick="mostrarCambiarEstado()">Cambiar estado</button><br><br>
                  <button onclick="mostrarBorrar()">Borrar libro</button><br><br>
                  <button onclick="volverMenu()">Volver</button>`;
    document.getElementById("contenido").innerHTML = html;
}

// Agregar libro
function mostrarAgregar() {
    let html = `<h2>üìò Agregar libro</h2>
                T√≠tulo: <input id="titulo"><br>
                Autor: <input id="autor"><br>
                A√±o: <input id="a√±o"><br>
                G√©nero: <input id="genero"><br>
                Estado:
                <select id="estado">
                    <option value="Disponible">Disponible</option>
                    <option value="Prestado">Prestado</option>
                </select><br>
                <button onclick="agregarLibro()">Guardar</button>
                <br><button onclick="mostrarPanelAdmin()">Volver</button>`;
    document.getElementById("contenido").innerHTML = html;
}
function agregarLibro() {
    const libro = {
        T√≠tulo: document.getElementById("titulo").value,
        Autor: document.getElementById("autor").value,
        A√±o: document.getElementById("a√±o").value,
        G√©nero: document.getElementById("genero").value,
        Estado: document.getElementById("estado").value
    };
    let libros = cargarLibros();
    libros.push(libro);
    guardarLibros(libros);

    // üëâ Mensaje sin usar alert
    document.getElementById("contenido").innerHTML = `
        <div style="
            padding: 12px;
            background: #d4ffd4;
            border: 1px solid #89c789;
            border-radius: 6px;
            margin-bottom: 12px;
        ">
            üìò Libro agregado correctamente
        </div>
    `;

    mostrarPanelAdmin();
}

// Cambiar estado
function mostrarCambiarEstado() {
    let html = `<h2>üì¶ Cambiar estado</h2>
                T√≠tulo del libro: <input id="tituloEstado"><br>
                Nuevo estado:
                <select id="nuevoEstado">
                    <option value="Disponible">Disponible</option>
                    <option value="Prestado">Prestado</option>
                </select><br>
                <button onclick="cambiarEstado()">Cambiar</button>
                <br><button onclick="mostrarPanelAdmin()">Volver</button>
                <div id="mensajeEstado"></div>`;
    document.getElementById("contenido").innerHTML = html;
}

function cambiarEstado() {
    const titulo = normalizar(document.getElementById("tituloEstado").value);
    const nuevo = document.getElementById("nuevoEstado").value;
    let libros = cargarLibros();
    let encontrado = false;
    for (let libro of libros) {
        if (normalizar(libro.T√≠tulo) === titulo) {
            libro.Estado = nuevo;
            encontrado = true;
            break;
        }
    }
    guardarLibros(libros);
    document.getElementById("mensajeEstado").innerText = encontrado ? `‚úî Estado cambiado a '${nuevo}' correctamente` : "‚ùå Libro no encontrado";
}

// Borrar libro
function mostrarBorrar() {
    let html = `<h2>üóëÔ∏è Borrar libro</h2>
                T√≠tulo del libro: <input id="tituloBorrar"><br>
                <button onclick="borrarLibro()">Borrar</button>
                <br><button onclick="mostrarPanelAdmin()">Volver</button>
                <div id="mensajeBorrar"></div>`;
    document.getElementById("contenido").innerHTML = html;
}

function borrarLibro() {
    const titulo = normalizar(document.getElementById("tituloBorrar").value);
    let libros = cargarLibros();
    const index = libros.findIndex(libro => normalizar(libro.T√≠tulo) === titulo);
    if (index >= 0) {
        const eliminado = libros.splice(index, 1);
        guardarLibros(libros);
        document.getElementById("mensajeBorrar").innerText = `‚úî Libro '${eliminado[0].T√≠tulo}' eliminado correctamente`;
    } else {
        document.getElementById("mensajeBorrar").innerText = "‚ùå Libro no encontrado";
    }
}

// Volver al men√∫ principal
function volverMenu() {
    document.getElementById("contenido").innerHTML = "";
}
</script>

</body>
<div id="creditos" style="
    margin-top: 30px;
    text-align: center;
    font-family: 'Arial', sans-serif;
    font-size: 16px;
    color: #555;
    background-color: #f0f0f0;
    padding: 10px 0;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    width: 300px;
    margin-left: auto;
    margin-right: auto;
">
    <p style="font-weight: bold; margin: 5px 0;">Hecho por:</p>
    <p style="margin: 3px 0;">Marian Duarte</p>
    <p style="margin: 3px 0;">Alan Ayala</p>
    <p style="margin: 3px 0;">Flavia Benitez</p>
</div>
</body>
</html>